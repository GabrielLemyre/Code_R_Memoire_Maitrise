# ----------------------------------------------------------------------------------------------------
# Hidden Markov Models
# INFORMATION POUR PARAMÉTRISATION DU S&P TSX
# ----------------------------------------------------------------------------------------------------
# written
# Gabriel LEMYRE
# ----------------------------------------------------------------------------------------------------
# Under the supervision of :
# Maciej AUGUSTYNIAK
# ----------------------------------------------------------------------------------------------------
# Last version : 15 avril 2019
# Last version : 4 mars 2020
# ----------------------------------------------------------------------------------------------------

# # Closing all connections
# closeAllConnections()
# # Vide la cache de R
# rm(list=ls())
# # Retrait de tous les graphiques ouvert
# graphics.off()
# --------------------------------------------------------
# S&P TSX - paramétrisation
# --------------------------------------------------------
# 
# --------------------------------------------------------
# TEST SI DOCUMENT APPELÉ DE L'EXTÉRIEUR OU PAS,
#   Si appelé de l'extérieur, 
if(tryCatch(outside.run, error = function(err){return(TRUE)})){
  # Closing all connections
  closeAllConnections()
  # Vide la cache de R
  rm(list=ls())
  # Retrait de tous les graphiques ouvert
  graphics.off()
  outside.run <- TRUE
  ignored.files.OUTSIDE.RUN <- "Parametrisations"
} else {
  ignored.files.OUTSIDE.RUN <- c()
}

# Chemin vers le document qui roule le modèle
path.MAIN <- '~/Documents/GitHub/Memoire_Maitrise/code/r/__modelisation/main.R'

SP.TSX=list(
  data.pars = list(index="SP.TSX",
                   variables.explicatives = c(
                     "INDPRO.log",
                     "SP.TSX"
                   ),
                   transformations = c("logR",
                                       "scale"),
                   scalingFactor = c(100,
                                     100),
                   date.boundaries = c(as.Date("1999-12-31"),Sys.Date()), # Partagé par toutes les modèles
                   freq.str="Q"
  ),
  general.pars = list(
    # type.a.rouler = c("MELANGE","HMM"),
    # load.model = "/Users/gabriellemyre/Documents/GitHub/Memoire_Maitrise/__resultats/SP500/modèle optimal SP.500-[2020-12-22 16h05m15s].rds",
    # test.Transformations=TRUE,
    # 
    mu0 = list(
      "1" = c(0.03),
      "2" = c(-0.16,  0.06),
      "3" = c(-0.7, -0.1,  0.1),
      "4" = c(-0.43, -0.071,  0.13,  0.4)
    ),
    # 
    sigma0 = list(
      "1" = c(2.5),
      "2" = c(2.227, 0.731),
      "3" = c(3.660, 1.330, 0.558),
      "4" = c(3.744, 1.361, 0.552, 0.059)
    )
  ),
  UNIVARIEE = list(),
  # 
  MELANGE = list(
    K = c(2,
          3,
          4),
    gamma0 = list("2" = c(0.25, 0.75),
                  "3" = c(0.027, 0.478, 0.495),
                  "4" = c(0.051, 0.570, 0.373, 0.006))
  ),
  # 
  HMM = list(
    K = c(2,
          3,
          4),
    Transition.Type = "Homogeneous",
    gamma0 = list(
      "2" = matrix(c(0.981103103, 0.0188969, 
                     0.008198487, 0.9918015),
                   ncol=2 , byrow=T),
      "3" = matrix(c(0.98, 0.01, 0.01,
                     0.01, 0.98, 0.01,
                     0.01, 0.01, 0.98),
                   byrow=T,nrow=3),
      "4" = matrix(c(9.791353e-01, 2.695902e-07, 1.527788e-02, 5.586534e-03, 
                     6.668266e-11, 9.682687e-01, 3.173053e-02, 7.292526e-07,
                     9.760572e-03, 3.632286e-02, 9.532491e-01, 6.674701e-04,
                     3.702408e-02, 1.075279e-09, 1.519283e-09, 9.629759e-01),
                   ncol=4 , byrow=T)
    ),
    initial.Distribution = list(
      "2" = list(c(0.25, 0.75)),
      "3" = list(c(0,1,0)),
      "4" = list(c(0.051, 0.570, 0.373, 0.006),
                 c(0, 1, 0, 0)))
  ),
  # 
  HHMM = list(
    K=4,
    gamma0 = list(
      "4" = matrix(
        c(0.97, 0.02, 0.01,
          0.97, 0.02, 0.01,
          0.97, 0.02, 0.01,
          0.97, 0.02, 0.01,
          0.9,       0.1,          0,
          0.9,       0.1,          0,
          0.6,       0.4,          0,
          0.6,       0.4,          0),
        ncol=3,byrow=T)
    ),
    initial.Distribution = list(
      "4" = list(
        c(0.051, 0.570, 0.373, 0.006),
        c(0, 1, 0, 0)
      )
    )
  ),
  # 
  LOGIT = list(
    K=4,
    Transition.Type = "LOGIT",
    gamma0 = list(
      "SP.500" = c(11.9153937,  -3.2901744,  -3.2196457,
                   9.6929927,   4.6357821,   3.6808849,
                   4.8872555,   9.7381110,  -2.8478310,
                   -11.7162761,   5.8048835,   1.0552933,
                   3.3021530,   1.9993717,   1.3619955,
                   -0.4021961,   0.2381303,  -0.4848302,
                   -1.5521677,  -0.5938818,  -3.0357197,
                   -1.9905202,  -3.1908825,  -7.6027283),
      "INDPRO.log" = c(12.0525027,  -3.2897033,  -3.2194887,
                       25.3769695,  21.8681980,  20.1045678,
                       21.8813330,  25.8046022, -10.2094039,
                       -13.0967651,  18.2532958,  21.7022517,
                       1.6461908,   1.9992837,   1.3620767,
                       0.0836822,   1.4733259,  -0.9051992,
                       4.9144567,   3.6489609,  -8.7188818,
                       4.1613465,  -0.6103364,  -2.4674836),
      "CADUSD" = c(11.9153937,  -3.2901744,  -3.2196457,
                   9.6929927,   4.6357821,   3.6808849,
                   4.8872555,   9.7381110,  -2.8478310,
                   -11.7162761,   5.8048835,   1.0552933,
                   3.3021530,   1.9993717,   1.3619955,
                   -0.4021961,   0.2381303,  -0.4848302,
                   -1.5521677,  -0.5938818,  -3.0357197,
                   -1.9905202,  -3.1908825,  -7.6027283)
    ),
    initial.Distribution = list(
      "4" = list(
        c(0.051, 0.570, 0.373, 0.006),
        c(0, 1, 0, 0),
        c(0, 0, 1, 0)
      )
    )
  ),
  #
  GAS = list(
    K=2,
    Transition.Type = "GAS",
    gamma0 = list(
      "2" = c(0.25, 0.75, # Distribution initiale
              0.35, 0.99, # Diagonale de la matrice A
              0.7, 0.7)
    )
  ),
  # 
  DDMS = list(
    K = 4,
    tau = c(
      3,
      5,
      14
    ),
    gamma0 = list(
      "3" = c(
        5.54571041,  -7.09316803, -17.60058150,
        1.92126830,   9.55789379 ,  0.33323852 ,
        -6.72596344 , -5.44394512 ,-34.49364309 ,
        -17.40395599,  35.18301021,   1.88335345,
        -28.12525779 , -8.43910768 ,  5.69872720,
        19.15728930,  15.08404592,  17.69467818 ,
        10.07164248 ,  9.10485820, -15.38991616,
        -19.69177911, -32.79145376,   3
      ),
      "5" = c(
        59.91453972,  -1.64904429,  -7.27598508,
        0.99662845,   5.27200717,  -2.57066410,
        -5.83495685,  -4.71772568, -10.85254537,
        -13.05173796,  4.33822867,   1.72594976,
        -11.15481678,  -3.78925049,   1.35124304,
        10.41266240,   8.64395543,   9.92194490,
        9.20807702,   8.38269064, -3.22575694,
        -15.01073003,  -2.31479873,   3
      ),
      "14" = c(
        8.961617997, -1.032583962, -2.920765747,
        4.098249412,  4.854934116,  2.055460064,
        4.969377919,  5.867361786,  3.877113048,
        -4.523771549,  4.133218315, 1.826135688,
        1.693536686, -0.802182596,  2.085399334,
        0.547194978,  0.262358763, -0.303144257,
        6.385979156,  5.788265618, -0.1,
        -1.097014937, -2.070089732,  3
      )
    ),
    initial.Distribution = list(
      "4" = list(
        c(0.051, 0.570, 0.373, 0.006)
      )
    )
  )
)

if(outside.run){
  cat("Running", path.MAIN)
  run.model <- SP.TSX
  source(path.MAIN)
}
